#!/bin/bash

###############################################################################
# JADX Installation Script
# Dex to Java decompiler
###############################################################################

TOOL_NAME="jadx"
TOOL_DIR="/opt/android-pentest/tools/${TOOL_NAME}"
BIN_DIR="/opt/android-pentest/bin"
LOG_FILE="/opt/android-pentest/logs/${TOOL_NAME}_install.log"

source /opt/android-pentest/scripts/common_functions.sh

install_jadx() {
    log_info "Installing ${TOOL_NAME}..."
    
    mkdir -p "${TOOL_DIR}"
    cd "${TOOL_DIR}"
    
    # Get latest release
    JADX_VERSION="1.5.0"
    log_info "Downloading JADX v${JADX_VERSION}..."
    
    wget "https://github.com/skylot/jadx/releases/download/v${JADX_VERSION}/jadx-${JADX_VERSION}.zip" >> "$LOG_FILE" 2>&1
    unzip -q "jadx-${JADX_VERSION}.zip"
    rm "jadx-${JADX_VERSION}.zip"
    
    # Create wrapper scripts for both CLI and GUI
    create_wrapper "jadx" "${TOOL_DIR}/bin/jadx" ""
    create_wrapper "jadx-gui" "${TOOL_DIR}/bin/jadx-gui" ""
    
    # Test installation
    if "${TOOL_DIR}/bin/jadx" --version >> "$LOG_FILE" 2>&1; then
        log_success "${TOOL_NAME} installed successfully"
    else
        log_error "${TOOL_NAME} installation may have issues"
        return 1
    fi
}

install_jadx
