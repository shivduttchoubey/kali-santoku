#!/bin/bash

###############################################################################
# Apktool Installation Script
# A tool for reverse engineering Android apk files
###############################################################################

TOOL_NAME="apktool"
TOOL_DIR="/opt/android-pentest/tools/${TOOL_NAME}"
BIN_DIR="/opt/android-pentest/bin"
LOG_FILE="/opt/android-pentest/logs/${TOOL_NAME}_install.log"

source /opt/android-pentest/scripts/common_functions.sh

install_apktool() {
    log_info "Installing ${TOOL_NAME}..."
    
    mkdir -p "${TOOL_DIR}"
    cd "${TOOL_DIR}"
    
    # Download latest apktool
    log_info "Downloading apktool..."
    wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool -O apktool >> "$LOG_FILE" 2>&1
    wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar -O apktool.jar >> "$LOG_FILE" 2>&1
    
    chmod +x apktool
    
    # Create wrapper script
    create_wrapper "${TOOL_NAME}" "${TOOL_DIR}/apktool" ""
    
    # Test installation
    if "${TOOL_DIR}/apktool" --version >> "$LOG_FILE" 2>&1; then
        log_success "${TOOL_NAME} installed successfully"
    else
        log_error "${TOOL_NAME} installation failed"
        return 1
    fi
}

install_apktool
