#!/bin/bash

###############################################################################
# Radare2 Installation Script
# Reverse engineering framework
###############################################################################

TOOL_NAME="radare2"
TOOL_DIR="/opt/android-pentest/tools/${TOOL_NAME}"
BIN_DIR="/opt/android-pentest/bin"
LOG_FILE="/opt/android-pentest/logs/${TOOL_NAME}_install.log"

source /opt/android-pentest/scripts/common_functions.sh

install_radare2() {
    log_info "Installing ${TOOL_NAME}..."
    
    # Radare2 is best installed system-wide via package manager
    log_info "Installing radare2 from package manager..."
    apt install -y radare2 >> "$LOG_FILE" 2>&1
    
    # Also install r2ghidra for Ghidra decompiler integration
    log_info "Installing r2ghidra plugin..."
    
    mkdir -p "${TOOL_DIR}"
    cd "${TOOL_DIR}"
    
    git clone https://github.com/radareorg/r2ghidra.git >> "$LOG_FILE" 2>&1
    cd r2ghidra
    
    # Build and install r2ghidra
    r2pm -ci r2ghidra >> "$LOG_FILE" 2>&1 || log_warning "r2ghidra installation may have failed"
    
    # Test installation
    if command -v radare2 &> /dev/null; then
        log_success "${TOOL_NAME} installed successfully"
        radare2 -version | head -n 1 | tee -a "$LOG_FILE"
    else
        log_error "${TOOL_NAME} installation failed"
        return 1
    fi
}

install_radare2
