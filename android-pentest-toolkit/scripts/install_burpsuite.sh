#!/bin/bash

###############################################################################
# Burp Suite Community Edition Installation Script
# Web application security testing
###############################################################################

TOOL_NAME="burpsuite"
TOOL_DIR="/opt/android-pentest/tools/${TOOL_NAME}"
BIN_DIR="/opt/android-pentest/bin"
LOG_FILE="/opt/android-pentest/logs/${TOOL_NAME}_install.log"

source /opt/android-pentest/scripts/common_functions.sh

install_burpsuite() {
    log_info "Installing ${TOOL_NAME}..."
    
    mkdir -p "${TOOL_DIR}"
    cd "${TOOL_DIR}"
    
    # Download Burp Suite Community Edition
    log_info "Downloading Burp Suite Community Edition..."
    
    # Note: This downloads the installer, user will need to run it
    wget "https://portswigger-cdn.net/burp/releases/download?product=community&version=2023.12.1&type=Linux" -O burpsuite_community_linux.sh >> "$LOG_FILE" 2>&1
    
    chmod +x burpsuite_community_linux.sh
    
    log_info "Running Burp Suite installer (this may take a while)..."
    ./burpsuite_community_linux.sh -q -dir "${TOOL_DIR}" >> "$LOG_FILE" 2>&1
    
    # Create launcher script
    cat > "${TOOL_DIR}/burpsuite" << 'EOF'
#!/bin/bash
/opt/android-pentest/tools/burpsuite/BurpSuiteCommunity "$@"
EOF
    
    chmod +x "${TOOL_DIR}/burpsuite"
    
    # Create wrapper script
    if [ -f "${TOOL_DIR}/BurpSuiteCommunity" ]; then
        create_wrapper "burpsuite" "${TOOL_DIR}/burpsuite" ""
        log_success "${TOOL_NAME} installed successfully"
    else
        log_warning "${TOOL_NAME} may not have installed correctly"
        log_info "You may need to manually run: ${TOOL_DIR}/burpsuite_community_linux.sh"
    fi
}

install_burpsuite
