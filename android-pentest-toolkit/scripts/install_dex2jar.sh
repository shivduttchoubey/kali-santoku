#!/bin/bash

###############################################################################
# dex2jar Installation Script
# Tools to work with Android .dex and Java .class files
###############################################################################

TOOL_NAME="dex2jar"
TOOL_DIR="/opt/android-pentest/tools/${TOOL_NAME}"
BIN_DIR="/opt/android-pentest/bin"
LOG_FILE="/opt/android-pentest/logs/${TOOL_NAME}_install.log"

source /opt/android-pentest/scripts/common_functions.sh

install_dex2jar() {
    log_info "Installing ${TOOL_NAME}..."
    
    mkdir -p "${TOOL_DIR}"
    cd "${TOOL_DIR}"
    
    # Download dex2jar
    DEX2JAR_VERSION="2.1"
    log_info "Downloading dex2jar v${DEX2JAR_VERSION}..."
    
    wget "https://github.com/pxb1988/dex2jar/releases/download/v${DEX2JAR_VERSION}/dex2jar-${DEX2JAR_VERSION}.zip" >> "$LOG_FILE" 2>&1
    unzip -q "dex2jar-${DEX2JAR_VERSION}.zip"
    mv "dex2jar-${DEX2JAR_VERSION}"/* .
    rmdir "dex2jar-${DEX2JAR_VERSION}"
    rm "dex2jar-${DEX2JAR_VERSION}.zip"
    
    # Make scripts executable
    chmod +x *.sh
    
    # Create wrapper scripts
    create_wrapper "d2j-dex2jar" "${TOOL_DIR}/d2j-dex2jar.sh" ""
    create_wrapper "d2j-jar2dex" "${TOOL_DIR}/d2j-jar2dex.sh" ""
    create_wrapper "d2j-apk-sign" "${TOOL_DIR}/d2j-apk-sign.sh" ""
    
    log_success "${TOOL_NAME} installed successfully"
}

install_dex2jar
